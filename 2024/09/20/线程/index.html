
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>çº¿ç¨‹ | Kola&#39;s nest</title>
    <meta name="author" content="wxd666" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>


<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css" />
<script src="/js/lib/math.js"></script>


<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />


<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜ æµè§ˆå™¨é»˜è®¤å¼€å¯</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>KOLA&#39;S NEST</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;KOLA&#39;S NEST</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>çº¿ç¨‹</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/9/20
        </span>
        
        <span class="category">
            <a href="/categories/%E7%90%86%E8%AE%BA/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                ç†è®º
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/Linux/" style="color: #00a596">
                    Linux
                </a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <h1 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h1>
<p><strong>linux</strong>ä¸­çº¿ç¨‹åˆå«åšè½»é‡çº§è¿›ç¨‹ï¼ˆlight-weight process
LWPï¼‰ï¼Œä¹Ÿæœ‰PCBï¼Œåˆ›å»ºçº¿ç¨‹ä½¿ç”¨çš„åº•å±‚å‡½æ•°å’Œè¿›ç¨‹åº•å±‚ä¸€æ ·ï¼Œéƒ½æ˜¯cloneï¼Œä½†æ²¡æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼›è€Œè¿›ç¨‹æœ‰ç‹¬ç«‹åœ°å€ç©ºé—´ï¼Œæ‹¥æœ‰PCBã€‚
Linuxä¸‹ï¼šçº¿ç¨‹æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚è¿›ç¨‹æ˜¯æœ€å°åˆ†é…èµ„æºå•ä½ï¼Œå¯çœ‹æˆæ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„è¿›ç¨‹ã€‚
çº¿ç¨‹æ˜¯ä¸€ä¸ªè¿›ç¨‹å†…éƒ¨çš„æ§åˆ¶åºåˆ—ã€‚æ§åˆ¶åºåˆ—å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ‰§è¡Œæµã€‚è¿›ç¨‹å†…éƒ¨æ˜¯æŒ‡è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚</p>
<h3 id="pthread_create">1.
<strong><code>pthread_create()</code></strong></h3>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ã€‚</li>
<li><strong>å‚æ•°</strong>ï¼š
<ul>
<li>çº¿ç¨‹IDï¼ˆ<code>&amp;pthread_t</code>ï¼‰ã€‚ä¼ å…¥çº¿ç¨‹idçš„æŒ‡é’ˆ</li>
<li>çº¿ç¨‹å±æ€§ï¼ˆå¯ä»¥ä¸º <code>NULL</code>ï¼Œè¡¨ç¤ºé»˜è®¤å±æ€§ï¼‰ã€‚</li>
<li>çº¿ç¨‹å‡½æ•°ï¼ˆçº¿ç¨‹å¯åŠ¨æ—¶æ‰§è¡Œçš„å‡½æ•°ï¼‰ã€‚</li>
<li>çº¿ç¨‹å‚æ•°ï¼ˆä¼ é€’ç»™çº¿ç¨‹å‡½æ•°çš„å‚æ•°ï¼‰ã€‚</li>
</ul></li>
<li><strong>è¿”å›å€¼</strong>ï¼šæˆåŠŸæ—¶è¿”å›
<code>0</code>ï¼Œå¤±è´¥æ—¶è¿”å›é”™è¯¯ç ã€‚</li>
<li><strong>æ³¨æ„ï¼šç¬¬ä¸‰æ–¹åº“, éœ€è¦æ‰‹åŠ¨é“¾æ¥ -lpthread</strong></li>
</ul>
<span id="more"></span>
<h3 id="pthread_exit">2.
<strong><code>pthread_exit()</code></strong></h3>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šç»“æŸè°ƒç”¨çº¿ç¨‹çš„æ‰§è¡Œï¼Œå¹¶å¯ä»¥è¿”å›ä¸€ä¸ªå€¼ç»™å…¶ä»–çº¿ç¨‹ã€‚</li>
<li><strong>å‚æ•°</strong>ï¼šè¿”å›å€¼ï¼ˆå¯ä»¥ä¸º <code>NULL</code>ï¼‰ã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼šå¦‚æœä¸»çº¿ç¨‹è°ƒç”¨æ­¤å‡½æ•°ï¼Œæ•´ä¸ªè¿›ç¨‹ä¼šç»ˆæ­¢ã€‚</li>
</ul>
<h3 id="pthread_joinpthread_t-thread-void-retval">3.
<strong><code>pthread_join(pthread_t thread, void **retval)</code></strong></h3>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šç­‰å¾…æŒ‡å®šçº¿ç¨‹ç»“æŸï¼Œè·å–å…¶è¿”å›å€¼ã€‚</li>
<li><strong>å‚æ•°</strong>ï¼š
<ul>
<li>çº¿ç¨‹IDï¼ˆ<code>pthread_t</code>ï¼‰ã€‚</li>
<li>æŒ‡å‘è¿”å›å€¼çš„æŒ‡é’ˆï¼ˆå¯ä»¥ä¸º <code>NULL</code>,
è¡¨ç¤ºä¸è·å–è¿”å›å€¼ï¼‰ã€‚</li>
</ul></li>
<li><strong>è¿”å›å€¼</strong>ï¼šæˆåŠŸæ—¶è¿”å›
<code>0</code>ï¼Œå¤±è´¥æ—¶è¿”å›é”™è¯¯ç ã€‚</li>
<li>ä½¿ç”¨<strong>äºŒçº§æŒ‡é’ˆ</strong>çš„åœºæ™¯ï¼š
<ul>
<li>ä¼ é€’ï¼Œè¢«è°ƒå‡½æ•°ä¿®æ”¹ä¸»è°ƒæ–¹çš„æŒ‡é’ˆæŒ‡å‘</li>
<li>åç§»ï¼Œ ä¸»è°ƒå‡½æ•°å­˜åœ¨ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œä¼ é€’æ—¶é€€åŒ–</li>
</ul></li>
</ul>
<h3 id="pthread_detach">4.
<strong><code>pthread_detach()</code></strong></h3>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šå°†çº¿ç¨‹è®¾ç½®ä¸ºâ€œåˆ†ç¦»çŠ¶æ€â€ï¼Œä½¿å…¶åœ¨ç»“æŸæ—¶è‡ªåŠ¨é‡Šæ”¾èµ„æºã€‚</li>
<li><strong>å‚æ•°</strong>ï¼šçº¿ç¨‹IDï¼ˆ<code>pthread_t</code>ï¼‰ã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼šä¸€æ—¦çº¿ç¨‹è¢«åˆ†ç¦»ï¼Œæ— æ³•å†è°ƒç”¨
<code>pthread_join()</code>ã€‚</li>
</ul>
<h3 id="pthread_cancel">5.
<strong><code>pthread_cancel()</code></strong></h3>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè¯·æ±‚å–æ¶ˆæŒ‡å®šçš„çº¿ç¨‹(Send a cancelation request
to a thread)ã€‚</li>
<li><strong>å‚æ•°</strong>ï¼šçº¿ç¨‹IDï¼ˆ<code>pthread_t</code>ï¼‰ã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼šçº¿ç¨‹å¿…é¡»åœ¨å¯å–æ¶ˆçŠ¶æ€ä¸‹ï¼Œæ‰èƒ½è¢«å–æ¶ˆã€‚</li>
<li>çº¿ç¨‹ä¼šåœ¨å–æ¶ˆç‚¹ï¼ˆIOæ“ä½œï¼‰å–æ¶ˆï¼Œè€Œéç«‹åˆ»å–æ¶ˆ</li>
<li>å¯ä»¥è°ƒç”¨<code>pthread_testcancel()</code> ,æ‰‹åŠ¨æ·»åŠ å–æ¶ˆç‚¹</li>
<li>å–æ¶ˆæœºåˆ¶å¯èƒ½ä¼šå¼•èµ·<strong>èµ„æºæ³„éœ²</strong></li>
</ul>
<hr />
<p>è¡¥å……çŸ¥è¯†ï¼šèµ„æºæ¸…ç†æ ˆï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ç»™èµ„æºæ“¦å±è‚¡ï¼Œå³åœ¨ç”³è¯·èµ„æºä¹‹åï¼Œè°ƒç”¨<code>pthread_cleanup_push((void *routine)(void*), void*arg)</code>
, åŒ…è£…å‡½æ•°routineæ˜¯ä¸€ä¸ªè¿”å›å€¼voidï¼Œå‚æ•°ç±»å‹void*
çš„ç»Ÿä¸€å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­å°†ä¼ å…¥çš„ï¼ˆå„ç§ï¼‰<em>å‚æ•°</em>å¼ºè½¬ï¼Œå†ä½œç›¸åº”å¤„ç†</p>
<p>å®ƒæœ¬èº«ä¸æ˜¯å–æ¶ˆç‚¹ï¼Œæ‰€ä»¥ä¸€ä¸ªèµ„æºè¢«åˆ›å»ºåï¼Œä¸€å®šä¼šå…¥æ ˆï¼Œæ³¨æ„æ¯ä¸€ä¸ªcleanupéƒ½å¿…é¡»æ­é…ä¸€ä¸ª<code>pthread_cleanup_pop(1)</code>
è¡¨ç¤ºå‡ºæ ˆï¼Œè¿™æ ·çº¿ç¨‹åœ¨popä¹‹å‰æŒ‚æ‰çš„è¯ï¼Œèµ„æºä¼šè‡ªåŠ¨å‡ºæ ˆï¼Œå¹¶è°ƒç”¨ç›¸åº”çš„åŒ…è£…å‡½æ•°
ï¼Œå¦‚æœçº¿ç¨‹æ­£å¸¸ç»“æŸï¼Œpopä¹Ÿä¼šæŒ‰é¡ºåºæ‰§è¡Œï¼Œå®Œæˆèµ„æºæ¸…ç†ï¼Œæ­¤å‡½æ•°å‚æ•°ä¸ºé›¶è¡¨ç¤ºåªå‡ºæ ˆï¼Œä¸æ¸…ç†èµ„æº</p>
<hr />
<p>åœ¨ <code>pthread</code>
åº“ä¸­ï¼Œé”æ˜¯ç”¨äºåŒæ­¥å¤šçº¿ç¨‹è®¿é—®å…±äº«èµ„æºçš„é‡è¦å·¥å…·ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–å·²è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰çš„é”ï¼Œå®ƒå°†è¢«é˜»å¡ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ğŸ˜€</p>
<h3
id="pthread_mutex_t"><strong><code>pthread_mutex_t</code></strong></h3>
<p>â˜ğŸ»è¿™æ˜¯ç”¨äºåˆ›å»ºäº’æ–¥é”çš„åŸºæœ¬æ•°æ®ç»“æ„ã€‚</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> pthread_mutex_init<span class="op">(</span>pthread_mutex_t <span class="op">*</span>mutex<span class="op">,</span> <span class="dt">const</span> pthread_mutexattr_t <span class="op">*</span>attr<span class="op">);</span></span></code></pre></div>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šåˆå§‹åŒ–ä¸€ä¸ªäº’æ–¥é”ã€‚</li>
<li><strong>å‚æ•°</strong>ï¼š
<ul>
<li><code>mutex</code>ï¼šæŒ‡å‘è¦åˆå§‹åŒ–çš„äº’æ–¥é”ã€‚</li>
<li><code>attr</code>ï¼šé”çš„å±æ€§ï¼Œå¯ä»¥ä¸º <code>NULL</code>
è¡¨ç¤ºä½¿ç”¨é»˜è®¤å±æ€§ã€‚</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> pthread_mutex_lock<span class="op">(</span>pthread_mutex_t <span class="op">*</span>mutex<span class="op">);</span></span></code></pre></div>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šé”å®šäº’æ–¥é”ã€‚</li>
<li><strong>å‚æ•°</strong>ï¼šæŒ‡å‘è¦åŠ é”çš„äº’æ–¥é”ã€‚</li>
<li><strong>è¿”å›å€¼</strong>ï¼šæˆåŠŸæ—¶è¿”å› 0ï¼Œå¤±è´¥æ—¶è¿”å›é”™è¯¯ç ã€‚</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> pthread_mutex_unlock<span class="op">(</span>pthread_mutex_t <span class="op">*</span>mutex<span class="op">);</span></span></code></pre></div>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè§£é”äº’æ–¥é”ã€‚</li>
<li><strong>å‚æ•°</strong>ï¼šæŒ‡å‘è¦è§£é”çš„äº’æ–¥é”ã€‚</li>
<li><strong>è¿”å›å€¼</strong>ï¼šæˆåŠŸæ—¶è¿”å› 0ï¼Œå¤±è´¥æ—¶è¿”å›é”™è¯¯ç ã€‚</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> pthread_mutex_destroy<span class="op">(</span>pthread_mutex_t <span class="op">*</span>mutex<span class="op">);</span></span></code></pre></div>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šé”€æ¯äº’æ–¥é”ã€‚</li>
<li><strong>å‚æ•°</strong>ï¼šæŒ‡å‘è¦é”€æ¯çš„äº’æ–¥é”ã€‚</li>
<li><strong>è¿”å›å€¼</strong>ï¼šæˆåŠŸæ—¶è¿”å› 0ï¼Œå¤±è´¥æ—¶è¿”å›é”™è¯¯ç ã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼šåœ¨é”€æ¯ä¹‹å‰ï¼Œç¡®ä¿æ²¡æœ‰çº¿ç¨‹æŒæœ‰è¯¥é”ã€‚</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> pthread_mutex_trylock<span class="op">(</span>pthread_mutex_t <span class="op">*</span>mutex<span class="op">);</span></span></code></pre></div>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šå°è¯•é”å®šäº’æ–¥é”ï¼Œè‹¥é”å·²è¢«å…¶ä»–çº¿ç¨‹é”å®šåˆ™ç«‹å³è¿”å›ã€‚</li>
<li><strong>å‚æ•°</strong>ï¼šæŒ‡å‘è¦å°è¯•åŠ é”çš„äº’æ–¥é”ã€‚</li>
<li><strong>è¿”å›å€¼</strong>ï¼š
<ul>
<li>æˆåŠŸæ—¶è¿”å› 0ã€‚</li>
<li>è‹¥é”å·²è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™è¿”å› <code>EBUSY</code>ã€‚</li>
</ul></li>
</ul>
<h3 id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>pthread_mutex_t lock<span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> shared_data <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> thread_function<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">)</span> <span class="op">&#123;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_lock<span class="op">(&amp;</span>lock<span class="op">);</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    shared_data<span class="op">++;</span> <span class="co">// è®¿é—®å…±äº«æ•°æ®</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_unlock<span class="op">(&amp;</span>lock<span class="op">);</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">&#123;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    pthread_t threads<span class="op">[</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_init<span class="op">(&amp;</span>lock<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">&#123;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        pthread_create<span class="op">(&amp;</span>threads<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">,</span> thread_function<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">&#123;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        pthread_join<span class="op">(</span>threads<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">);</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;Final shared_data: </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> shared_data<span class="op">);</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_destroy<span class="op">(&amp;</span>lock<span class="op">);</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<ul>
<li><p>ä½¿ç”¨äº’æ–¥é”å¯ä»¥æœ‰æ•ˆé˜²æ­¢æ•°æ®ç«äº‰å’Œä¸ä¸€è‡´æ€§ã€‚</p></li>
<li><p>ç¡®ä¿åœ¨è§£é”ä¹‹å‰æ¯æ¬¡åŠ é”éƒ½æˆåŠŸï¼Œå¹¶åœ¨ä½¿ç”¨å®Œåé”€æ¯é”ã€‚</p></li>
<li><p>å°½é‡é¿å…é•¿æ—¶é—´æŒæœ‰é”ï¼Œä»¥æé«˜ç³»ç»Ÿæ€§èƒ½ã€‚</p></li>
</ul>
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 50%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">é”ç±»å‹</th>
<th style="text-align: left;">ç‰¹ç‚¹</th>
<th style="text-align: left;">ä½¿ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">äº’æ–¥é”</td>
<td style="text-align: left;">ä¿æŠ¤ä¸´ç•ŒåŒºï¼Œé˜»æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®</td>
<td style="text-align: left;">ä¸€èˆ¬ä¸´ç•ŒåŒºä¿æŠ¤</td>
</tr>
<tr>
<td style="text-align: left;">è¯»å†™é”</td>
<td style="text-align: left;">å¤šè¯»å•å†™ï¼Œé€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯</td>
<td style="text-align: left;">æ•°æ®åº“æŸ¥è¯¢ã€å…±äº«é…ç½®è¯»å–</td>
</tr>
<tr>
<td style="text-align: left;">è‡ªæ—‹é”</td>
<td style="text-align: left;">è½»é‡çº§é”ï¼Œé€‚åˆçŸ­æ—¶é—´æŒæœ‰</td>
<td style="text-align: left;">å¤šæ ¸å¤„ç†å™¨ï¼ŒçŸ­æ—¶é—´é”æ“ä½œ</td>
</tr>
<tr>
<td style="text-align: left;">å¯é‡å…¥é”</td>
<td style="text-align: left;">åŒä¸€çº¿ç¨‹å¯å¤šæ¬¡è·å–</td>
<td style="text-align: left;">é€’å½’è°ƒç”¨æˆ–å¤æ‚å¯¹è±¡æ“ä½œ</td>
</tr>
<tr>
<td style="text-align: left;">æ¡ä»¶å˜é‡</td>
<td style="text-align: left;">çº¿ç¨‹ç­‰å¾…æŸä¸ªæ¡ä»¶</td>
<td style="text-align: left;">ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</td>
</tr>
<tr>
<td style="text-align: left;">ä¿¡å·é‡</td>
<td style="text-align: left;">æ§åˆ¶å¹¶å‘è®¿é—®æ•°é‡</td>
<td style="text-align: left;">é™åˆ¶èµ„æºè®¿é—®ã€çº¿ç¨‹æ± ç­‰</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="pthread_mutex_lock-å’Œ-pthread_mutex_unlock">6.
<strong><code>pthread_mutex_lock()</code> å’Œ
<code>pthread_mutex_unlock()</code></strong></h3>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šç”¨äºåŠ é”å’Œè§£é”äº’æ–¥é‡ï¼Œç¡®ä¿å¯¹å…±äº«èµ„æºçš„å®‰å…¨è®¿é—®ã€‚</li>
<li><strong>å‚æ•°</strong>ï¼šäº’æ–¥é‡ï¼ˆ<code>pthread_mutex_t</code>
*mutexï¼‰ã€‚</li>
<li><strong>è¿”å›å€¼</strong>ï¼šæˆåŠŸæ—¶è¿”å›
<code>0</code>ï¼Œå¤±è´¥æ—¶è¿”å›é”™è¯¯ç ã€‚</li>
</ul>
<hr />
<p>åœ¨ <code>pthread</code>
åº“ä¸­ï¼Œæ¡ä»¶å˜é‡ï¼ˆ<code>pthread_cond_t</code>ï¼‰ç”¨äºçº¿ç¨‹é—´çš„åŒæ­¥ï¼Œå…è®¸çº¿ç¨‹åœ¨æŸä¸ªæ¡ä»¶å‘ç”Ÿå˜åŒ–æ—¶è¿›è¡Œç­‰å¾…å’Œé€šçŸ¥ã€‚æ¡ä»¶å˜é‡çš„ä½¿ç”¨åœºæ™¯é€šå¸¸ä¸å…±äº«èµ„æºçš„çŠ¶æ€å˜åŒ–æœ‰å…³ï¼Œå°¤å…¶æ˜¯åœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ç­‰å¤šçº¿ç¨‹åœºæ™¯ä¸­ã€‚ğŸ˜€</p>
<h3 id="æ¡ä»¶å˜é‡çš„åŸºæœ¬æ¦‚å¿µ">1. æ¡ä»¶å˜é‡çš„åŸºæœ¬æ¦‚å¿µ</h3>
<p>æ¡ä»¶å˜é‡çš„æœ¬è´¨æ˜¯æä¾›ä¸€ç§çº¿ç¨‹é—´çš„åè°ƒæœºåˆ¶ï¼Œä½¿å¾—ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿåœ¨æŸä¸ªæ¡ä»¶ä¸æ»¡è¶³æ—¶æŒ‚èµ·ï¼Œå¹¶åœ¨æ¡ä»¶æ»¡è¶³æ—¶è¢«å…¶ä»–çº¿ç¨‹å”¤é†’ã€‚å®ƒä»¬é€šå¸¸ä¸äº’æ–¥é”ï¼ˆ<code>pthread_mutex_t</code>ï¼‰ç»“åˆä½¿ç”¨ï¼Œä»¥ç¡®ä¿åœ¨æ£€æŸ¥æ¡ä»¶å’Œä¿®æ”¹å…±äº«èµ„æºæ—¶çš„çº¿ç¨‹å®‰å…¨ã€‚å®ƒå…è®¸çº¿ç¨‹ç­‰å¾…æŸä¸ªæ¡ä»¶çš„å‘ç”Ÿï¼ˆä¾‹å¦‚ï¼ŒæŸä¸ªèµ„æºå¯ç”¨ï¼‰ï¼Œè€Œä¸å ç”¨
CPU èµ„æº</p>
<h3 id="ä¸»è¦å‡½æ•°">2. ä¸»è¦å‡½æ•°</h3>
<p>ä»¥ä¸‹æ˜¯æ¡ä»¶å˜é‡çš„ä¸»è¦å‡½æ•°åŠå…¶ç”¨é€”ï¼š</p>
<ul>
<li><p><strong>åˆå§‹åŒ–</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pthread_cond_t cond <span class="op">=</span> PTHREAD_COND_INITIALIZER<span class="op">;</span></span></code></pre></div>
<p>æˆ–ä½¿ç”¨ï¼š</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pthread_cond_init<span class="op">(&amp;</span>cond<span class="op">,</span> NULL<span class="op">);</span></span></code></pre></div></li>
<li><p><strong>ç­‰å¾…</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pthread_cond_wait<span class="op">(&amp;</span>cond<span class="op">,</span> <span class="op">&amp;</span>mutex<span class="op">);</span></span></code></pre></div>
<ul>
<li>è¯¥å‡½æ•°ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°æ¥æ”¶åˆ°ä¸€ä¸ªä¿¡å·ã€‚å®ƒåœ¨ç­‰å¾…ä¹‹å‰ä¼š<strong>è‡ªåŠ¨é‡Šæ”¾äº’æ–¥é”</strong>
<code>mutex</code>ï¼Œå¹¶åœ¨è¢«å”¤é†’åé‡æ–°è·å¾—è¯¥é”ã€‚</li>
</ul></li>
<li><p><strong>é€šçŸ¥</strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pthread_cond_signal<span class="op">(&amp;</span>cond<span class="op">);</span></span></code></pre></div>
<ul>
<li>å”¤é†’ä¸€ä¸ªç­‰å¾…è¯¥æ¡ä»¶å˜é‡çš„çº¿ç¨‹ã€‚â˜ğŸ»</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pthread_cond_broadcast<span class="op">(&amp;</span>cond<span class="op">);</span></span></code></pre></div>
<ul>
<li>å”¤é†’æ‰€æœ‰ç­‰å¾…è¯¥æ¡ä»¶å˜é‡çš„çº¿ç¨‹ã€‚â˜ğŸ»</li>
</ul></li>
<li><p><strong>é”€æ¯</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pthread_cond_destroy<span class="op">(&amp;</span>cond<span class="op">);</span></span></code></pre></div>
<ul>
<li>é”€æ¯æ¡ä»¶å˜é‡ï¼Œé‡Šæ”¾ç›¸å…³èµ„æºã€‚</li>
</ul></li>
</ul>
<h3 id="ä½¿ç”¨åœºæ™¯">3. ä½¿ç”¨åœºæ™¯</h3>
<h4 id="ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜">ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜</h4>
<p>å…¸å‹çš„ä½¿ç”¨åœºæ™¯æ˜¯ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ï¼Œå…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼ˆç”Ÿäº§è€…ï¼‰ç”Ÿäº§æ•°æ®ï¼Œè€Œå¦ä¸€äº›çº¿ç¨‹ï¼ˆæ¶ˆè´¹è€…ï¼‰æ¶ˆè´¹æ•°æ®ã€‚æ¶ˆè´¹è€…åœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ç­‰å¾…ï¼Œç”Ÿäº§è€…åœ¨é˜Ÿåˆ—æ»¡æ—¶ç­‰å¾…ã€‚</p>
<h3 id="ç¤ºä¾‹ä»£ç ">4. ç¤ºä¾‹ä»£ç </h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ¡ä»¶å˜é‡ï¼š</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;my_header.h&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define RANDOM_SIDE </span><span class="dv">100</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DEFAULT_CAPCITY </span><span class="dv">10</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> node <span class="op">&#123;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> node <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val<span class="op">;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span> node_t<span class="op">;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> list <span class="op">&#123;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> node <span class="op">*</span>rear<span class="op">;</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> node <span class="op">*</span>front<span class="op">;</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> size<span class="op">;</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span>list_t<span class="op">;</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> isFull<span class="op">(</span>list_t <span class="op">*</span>li<span class="op">)&#123;</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> li<span class="op">-&gt;</span>size <span class="op">&gt;=</span> DEFAULT_CAPCITY<span class="op">;</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>list_t <span class="op">*</span>creatList<span class="op">()&#123;</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    list_t <span class="op">*</span>li <span class="op">=</span> <span class="op">(</span>list_t<span class="op">*)</span> calloc<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>list_t<span class="op">));</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> li<span class="op">;</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> enQ<span class="op">(</span>list_t <span class="op">*</span>li<span class="op">,</span> <span class="dt">int</span> val<span class="op">)&#123;</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>isFull<span class="op">(</span>li<span class="op">))</span> <span class="cf">return</span><span class="op">;</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    node_t <span class="op">*</span>new1 <span class="op">=</span> <span class="op">(</span>node_t<span class="op">*)</span>calloc<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    new1<span class="op">-&gt;</span>val <span class="op">=</span> val<span class="op">;</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>li<span class="op">-&gt;</span>size <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">&#123;</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        li<span class="op">-&gt;</span>front <span class="op">=</span> new1<span class="op">;</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>        li<span class="op">-&gt;</span>rear <span class="op">=</span> new1<span class="op">;</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span><span class="cf">else</span> <span class="op">&#123;</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>        li<span class="op">-&gt;</span>rear<span class="op">-&gt;</span>next <span class="op">=</span> new1<span class="op">;</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>        li<span class="op">-&gt;</span>rear <span class="op">=</span> new1<span class="op">;</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    li<span class="op">-&gt;</span>size<span class="op">++;</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> printList<span class="op">(</span>list_t <span class="op">*</span>li<span class="op">)&#123;</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>    node_t <span class="op">*</span>cur <span class="op">=</span> li<span class="op">-&gt;</span>front<span class="op">;</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span>cur<span class="op">)&#123;</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st"> &quot;</span><span class="op">,</span> cur<span class="op">-&gt;</span>val<span class="op">);</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>        cur <span class="op">=</span> cur<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> deQ<span class="op">(</span>list_t <span class="op">*</span>li<span class="op">)&#123;</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>li<span class="op">-&gt;</span>size <span class="op">==</span> <span class="dv">0</span><span class="op">)&#123;</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>        perror<span class="op">(</span><span class="st">&quot;empty q</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>        exit<span class="op">(-</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val <span class="op">=</span> li<span class="op">-&gt;</span>front<span class="op">-&gt;</span>val<span class="op">;</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>    node_t <span class="op">*</span>tmp <span class="op">=</span> li<span class="op">-&gt;</span>front<span class="op">;</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>    li<span class="op">-&gt;</span>front <span class="op">=</span> li<span class="op">-&gt;</span>front<span class="op">-&gt;</span>next<span class="op">;</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>tmp<span class="op">);</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>    li<span class="op">-&gt;</span>size<span class="op">--;</span></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> val<span class="op">;</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a><span class="co">/* Usage:  */</span></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> resource <span class="op">&#123;</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>    pthread_cond_t instock<span class="op">;</span> <span class="co">// è¡¨ç¤ºè´§æ¶å˜åŠ¨</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_t mutex<span class="op">;</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>    list_t <span class="op">*</span>commodities<span class="op">;</span></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span> resource_t<span class="op">;</span></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>producer<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)&#123;</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>    srand<span class="op">(</span>time<span class="op">(</span>NULL<span class="op">));</span></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>    resource_t <span class="op">*</span>re <span class="op">=</span> <span class="op">(</span>resource_t<span class="op">*)</span>arg<span class="op">;</span></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span><span class="dv">1</span><span class="op">)&#123;</span></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_lock<span class="op">(&amp;</span>re<span class="op">-&gt;</span>mutex<span class="op">);</span></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span><span class="op">(</span>re<span class="op">-&gt;</span>commodities<span class="op">-&gt;</span>size <span class="op">&gt;=</span> DEFAULT_CAPCITY<span class="op">)&#123;</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%ld</span><span class="st"> : å½“å‰è´§æ¶å·²æ»¡</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> pthread_self<span class="op">());</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>            <span class="co">//çº¿ç¨‹åœ¨æ¡ä»¶ä¸æ»¡è¶³æ—¶è°ƒç”¨ pthread_cond_wait ç­‰å¾…æ¡ä»¶å˜é‡ï¼Œå¹¶é‡Šæ”¾å…³è”çš„é”ã€‚</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>            pthread_cond_wait<span class="op">(&amp;</span>re<span class="op">-&gt;</span>instock<span class="op">,</span> <span class="op">&amp;</span>re<span class="op">-&gt;</span>mutex<span class="op">);</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> val <span class="op">=</span> rand<span class="op">()</span> <span class="op">%</span> RANDOM_SIDE<span class="op">;</span></span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%ld</span><span class="st"> ç”Ÿäº§è€…ç”Ÿäº§äº† </span><span class="sc">%d</span><span class="st"> å·å•†å“</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> pthread_self<span class="op">(),</span> val<span class="op">);</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>        enQ<span class="op">(</span>re<span class="op">-&gt;</span>commodities<span class="op">,</span> val<span class="op">);</span></span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;å½“å‰è´§æ¶ ï¼š&quot;</span><span class="op">);</span></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>        printList<span class="op">(</span>re<span class="op">-&gt;</span>commodities<span class="op">);</span></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>        <span class="co">//å½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œè°ƒç”¨ pthread_cond_signalæ¥å”¤é†’ç­‰å¾…çš„çº¿ç¨‹</span></span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>        pthread_cond_signal<span class="op">(&amp;</span>re<span class="op">-&gt;</span>instock<span class="op">);</span></span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_unlock<span class="op">(&amp;</span>re<span class="op">-&gt;</span>mutex<span class="op">);</span></span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>        sleep<span class="op">(</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>consumer<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)&#123;</span></span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>    sleep<span class="op">(</span><span class="dv">5</span><span class="op">);</span></span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>    resource_t <span class="op">*</span>re <span class="op">=</span> <span class="op">(</span>resource_t<span class="op">*)</span>arg<span class="op">;</span></span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span><span class="dv">1</span><span class="op">)&#123;</span></span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_lock<span class="op">(&amp;</span>re<span class="op">-&gt;</span>mutex<span class="op">);</span></span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span><span class="op">(</span>re<span class="op">-&gt;</span>commodities<span class="op">-&gt;</span>size <span class="op">&lt;</span> <span class="dv">1</span><span class="op">)&#123;</span></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%ld</span><span class="st"> : å½“å‰è´§æ¶ä¸ºç©º</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> pthread_self<span class="op">());</span></span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>            pthread_cond_wait<span class="op">(&amp;</span>re<span class="op">-&gt;</span>instock<span class="op">,</span> <span class="op">&amp;</span>re<span class="op">-&gt;</span>mutex<span class="op">);</span></span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>        <span class="op">&#125;</span></span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%ld</span><span class="st"> æ¶ˆè´¹è€…æ¶ˆè´¹äº† </span><span class="sc">%d</span><span class="st"> å·å•†å“</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span>pthread_self<span class="op">()</span> <span class="op">,</span> deQ<span class="op">(</span>re<span class="op">-&gt;</span>commodities<span class="op">));</span></span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;å½“å‰è´§æ¶ ï¼š&quot;</span><span class="op">);</span></span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>        printList<span class="op">(</span>re<span class="op">-&gt;</span>commodities<span class="op">);</span></span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>        pthread_cond_signal<span class="op">(&amp;</span>re<span class="op">-&gt;</span>instock<span class="op">);</span></span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_unlock<span class="op">(&amp;</span>re<span class="op">-&gt;</span>mutex<span class="op">);</span></span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a>        sleep<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])&#123;</span>                                  </span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a>    list_t <span class="op">*</span>li <span class="op">=</span> creatList<span class="op">();</span></span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a>    srand<span class="op">(</span>time<span class="op">(</span>NULL<span class="op">));</span></span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a>    <span class="co">// åˆå§‹åŒ–å•†å“</span></span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">8</span><span class="op">;</span> i<span class="op">++)&#123;</span></span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a>        enQ<span class="op">(</span>li<span class="op">,</span> rand<span class="op">()%</span><span class="dv">100</span><span class="op">);</span>    </span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a>    <span class="op">&#125;</span></span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a>    printList<span class="op">(</span>li<span class="op">);</span></span>
<span id="cb13-130"><a href="#cb13-130" aria-hidden="true" tabindex="-1"></a>    resource_t re<span class="op">;</span></span>
<span id="cb13-131"><a href="#cb13-131" aria-hidden="true" tabindex="-1"></a>    re<span class="op">.</span>commodities <span class="op">=</span> li<span class="op">;</span></span>
<span id="cb13-132"><a href="#cb13-132" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_init<span class="op">(&amp;</span>re<span class="op">.</span>mutex<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb13-133"><a href="#cb13-133" aria-hidden="true" tabindex="-1"></a>    pthread_cond_init<span class="op">(&amp;</span>re<span class="op">.</span>instock<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb13-134"><a href="#cb13-134" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-135"><a href="#cb13-135" aria-hidden="true" tabindex="-1"></a>    pthread_t tid1<span class="op">,</span>tid2<span class="op">;</span></span>
<span id="cb13-136"><a href="#cb13-136" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>tid1<span class="op">,</span> NULL<span class="op">,</span> consumer<span class="op">,</span> <span class="op">&amp;</span>re<span class="op">);</span></span>
<span id="cb13-137"><a href="#cb13-137" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>tid2<span class="op">,</span> NULL<span class="op">,</span> consumer<span class="op">,</span> <span class="op">&amp;</span>re<span class="op">);</span></span>
<span id="cb13-138"><a href="#cb13-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-139"><a href="#cb13-139" aria-hidden="true" tabindex="-1"></a>    pthread_t tid3<span class="op">,</span>tid4<span class="op">,</span>tid5<span class="op">;</span></span>
<span id="cb13-140"><a href="#cb13-140" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>tid3<span class="op">,</span> NULL<span class="op">,</span> producer<span class="op">,</span> <span class="op">&amp;</span>re<span class="op">);</span></span>
<span id="cb13-141"><a href="#cb13-141" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>tid4<span class="op">,</span> NULL<span class="op">,</span> producer<span class="op">,</span> <span class="op">&amp;</span>re<span class="op">);</span></span>
<span id="cb13-142"><a href="#cb13-142" aria-hidden="true" tabindex="-1"></a>    pthread_create<span class="op">(&amp;</span>tid5<span class="op">,</span> NULL<span class="op">,</span> producer<span class="op">,</span> <span class="op">&amp;</span>re<span class="op">);</span></span>
<span id="cb13-143"><a href="#cb13-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-144"><a href="#cb13-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-145"><a href="#cb13-145" aria-hidden="true" tabindex="-1"></a>    pthread_join<span class="op">(</span>tid1<span class="op">,</span> NULL<span class="op">);</span> <span class="co">// éƒ½æ˜¯æ­»å¾ªç¯ï¼Œè±¡å¾æ€§çš„ç­‰ä¸€ä¸‹</span></span>
<span id="cb13-146"><a href="#cb13-146" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ï¼Œä¸ç„¶ä¸»è¿›ç¨‹å…³é—­ï¼Œçº¿ç¨‹éƒ½æ­»äº†</span></span>
<span id="cb13-147"><a href="#cb13-147" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb13-148"><a href="#cb13-148" aria-hidden="true" tabindex="-1"></a><span class="op">&#125;</span></span></code></pre></div>
<h3 id="æ€»ç»“-1">5. æ€»ç»“</h3>
<ul>
<li><strong>æœ¬è´¨</strong>ï¼šæ¡ä»¶å˜é‡æ˜¯çº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼Œå…è®¸çº¿ç¨‹åœ¨æŸä¸ªæ¡ä»¶ä¸æ»¡è¶³æ—¶æŒ‚èµ·ï¼Œå¹¶åœ¨æ¡ä»¶æ»¡è¶³æ—¶å”¤é†’ã€‚</li>
<li><strong>ä½•æ—¶ä½¿ç”¨</strong>ï¼šå½“çº¿ç¨‹éœ€è¦ç­‰å¾…æŸä¸ªæ¡ä»¶ï¼ˆå¦‚èµ„æºå¯ç”¨æ€§ï¼‰æ—¶ä½¿ç”¨æ¡ä»¶å˜é‡ï¼Œé€šå¸¸ä¸äº’æ–¥é”ä¸€èµ·ä½¿ç”¨æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚</li>
</ul>
<hr />
<h3 id="pthread_cond_waitæ¡ä»¶é‡-é”-å’Œ-pthread_cond_signalæ¡ä»¶é‡">7.
<strong><code>pthread_cond_wait(æ¡ä»¶é‡ï¼Œ é”)</code> å’Œ
<code>pthread_cond_signal(æ¡ä»¶é‡)</code></strong>ğŸ’•</h3>
<p><code>pthread_cond_wait</code>
æ˜¯ä¸€ä¸ªç”¨äºçº¿ç¨‹åŒæ­¥çš„å‡½æ•°ï¼Œå®ƒå…è®¸ä¸€ä¸ªçº¿ç¨‹åœ¨æŸä¸ªæ¡ä»¶ä¸æ»¡è¶³æ—¶è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</p>
<p>â‘ æ£€æŸ¥mutex â‘¡å…¥é˜Ÿ â‘¢è§£é”å¹¶é™·å…¥ç­‰å¾… â‘£ è¢«å”¤é†’å¹¶å‡ºé˜Ÿ â‘¤åŠ é”</p>
<h3 id="pthread_cond_wait-æµç¨‹"><code>pthread_cond_wait</code> æµç¨‹</h3>
<ol type="1">
<li><strong>è·å–äº’æ–¥é”</strong>ï¼š
<ul>
<li>åœ¨è°ƒç”¨ <code>pthread_cond_wait</code>
ä¹‹å‰ï¼Œçº¿ç¨‹å¿…é¡»å…ˆè·å–ä¸€ä¸ªäº’æ–¥é”ï¼ˆ<code>pthread_mutex_t</code>ï¼‰ã€‚è¿™ç¡®ä¿äº†å¯¹å…±äº«èµ„æºçš„å®‰å…¨è®¿é—®ã€‚</li>
</ul></li>
<li><strong>æ£€æŸ¥æ¡ä»¶</strong>ï¼š
<ul>
<li>çº¿ç¨‹æ£€æŸ¥æŸä¸ªæ¡ä»¶æ˜¯å¦æ»¡è¶³ã€‚å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</li>
</ul></li>
<li><strong>é‡Šæ”¾äº’æ–¥é”</strong>ï¼š
<ul>
<li>åœ¨è¿›å…¥ç­‰å¾…çŠ¶æ€ä¹‹å‰ï¼Œ<code>pthread_cond_wait</code>
ä¼šè‡ªåŠ¨é‡Šæ”¾æ‰€æŒæœ‰çš„äº’æ–¥é”ã€‚è¿™æ˜¯ä¸ºäº†å…è®¸å…¶ä»–çº¿ç¨‹åœ¨æ¡ä»¶æ»¡è¶³æ—¶å¯¹å…±äº«èµ„æºè¿›è¡Œä¿®æ”¹ã€‚</li>
</ul></li>
<li><strong>è¿›å…¥ç­‰å¾…çŠ¶æ€</strong>ï¼š
<ul>
<li>çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹é€šè¿‡
<code>pthread_cond_signal</code> æˆ– <code>pthread_cond_broadcast</code>
å”¤é†’ã€‚</li>
</ul></li>
<li><strong>é‡æ–°è·å¾—äº’æ–¥é”</strong>ï¼š
<ul>
<li>å½“çº¿ç¨‹è¢«å”¤é†’åï¼Œ<code>pthread_cond_wait</code>
ä¼šé‡æ–°è·å¾—ä¹‹å‰é‡Šæ”¾çš„äº’æ–¥é”ã€‚</li>
</ul></li>
<li><strong>è¿”å›å¹¶æ£€æŸ¥æ¡ä»¶</strong>ï¼š
<ul>
<li>çº¿ç¨‹è¿”å›åï¼Œé€šå¸¸éœ€è¦å†æ¬¡æ£€æŸ¥æ¡ä»¶ï¼Œå› ä¸ºåœ¨è¢«å”¤é†’åï¼Œæ¡ä»¶å¯èƒ½ä¾ç„¶ä¸æ»¡è¶³ã€‚</li>
</ul></li>
</ol>
<h3 id="åŸå­æ“ä½œ">åŸå­æ“ä½œ</h3>
<p>åœ¨ <code>pthread_cond_wait</code>
çš„æµç¨‹ä¸­ï¼Œä»¥ä¸‹æ­¥éª¤è¢«è§†ä¸ºåŸå­æ“ä½œï¼š</p>
<ol type="1">
<li><strong>é‡Šæ”¾äº’æ–¥é”å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€</strong>ï¼š
<ul>
<li><code>pthread_cond_wait</code>
ä¼šåœ¨è¿›å…¥ç­‰å¾…çŠ¶æ€æ—¶è‡ªåŠ¨é‡Šæ”¾äº’æ–¥é”ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯åŸå­çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹åœ¨é‡Šæ”¾é”çš„ç¬é—´ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•åŒæ—¶è·å¾—è¯¥é”ã€‚</li>
</ul></li>
<li><strong>é‡æ–°è·å¾—äº’æ–¥é”</strong>ï¼š
<ul>
<li>å½“æ¡ä»¶æ»¡è¶³ä¸”çº¿ç¨‹è¢«å”¤é†’æ—¶ï¼Œ<code>pthread_cond_wait</code>
ä¼šåœ¨è¿”å›æ—¶è‡ªåŠ¨é‡æ–°è·å¾—äº’æ–¥é”ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚</li>
</ul></li>
</ol>
<h3 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h3>
<ul>
<li>åœ¨è°ƒç”¨ <code>pthread_cond_wait</code>
ä¹‹å‰ï¼Œå¿…é¡»ç¡®ä¿äº’æ–¥é”å·²è¢«é”ä½ã€‚</li>
<li>åœ¨è¢«å”¤é†’åï¼Œçº¿ç¨‹åº”å†æ¬¡æ£€æŸ¥æ¡ä»¶ï¼Œè¿™ä¸ªæ£€æŸ¥æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨è™šå‡å”¤é†’ï¼ˆå³çº¿ç¨‹åœ¨æ²¡æœ‰æ¡ä»¶æ»¡è¶³çš„æƒ…å†µä¸‹è¢«å”¤é†’ï¼‰ã€‚</li>
</ul>
<hr />
<h3 id="pthread_self">8.
<strong><code>pthread_self()</code></strong></h3>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–å½“å‰çº¿ç¨‹çš„çº¿ç¨‹IDã€‚</li>
<li><strong>è¿”å›å€¼</strong>ï¼šè¿”å›å½“å‰çº¿ç¨‹çš„
<code>pthread_t</code>ã€‚</li>
</ul>
<h3 id="pthread_getschedparam-å’Œ-pthread_setschedparam">9.
<strong><code>pthread_getschedparam()</code> å’Œ
<code>pthread_setschedparam()</code></strong></h3>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–æˆ–è®¾ç½®çº¿ç¨‹çš„è°ƒåº¦ç­–ç•¥å’Œä¼˜å…ˆçº§ã€‚</li>
<li><strong>å‚æ•°</strong>ï¼š
<ul>
<li>çº¿ç¨‹IDï¼ˆ<code>pthread_t</code>ï¼‰ã€‚</li>
<li>æŒ‡å‘è°ƒåº¦å‚æ•°çš„ç»“æ„ä½“ã€‚</li>
</ul></li>
</ul>

    </div>
    
    
    
    
    <div id="comment">
        <div id="giscus-container" class="giscus"></div>
    </div>
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2023 - 2024 Kola&#39;s nest
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;wxd666
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    
<script
    src="https://giscus.app/client.js"
    data-repo="wxd6662019/wxd6662019.github.io"
    data-repo-id="R_kgDOMv_QXw"
    data-category="Announcements"
    data-category-id="DIC_kwDOMv_QX84CiZrp"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="preferred_color_scheme"
    data-lang="zh-CN"
    crossorigin
    async
></script>





    
</body>
</html>

